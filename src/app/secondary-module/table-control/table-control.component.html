<div class="wrapper">
    <div class="control-container">
        <button class="control-button" mat-stroked-button (click)="addData()">Добавить узел
        </button>
        <button class="control-button" mat-stroked-button [disabled]="!selection.selected?.length"
            (click)="removeData()">Удалить узел
        </button>
    </div>
    <div class="example-container mat-elevation-z8">
        <table mat-table [dataSource]="data" class="mat-elevation-z8">
            <!-- Checkbox Column -->
            <ng-container matColumnDef="select">
                <th mat-header-cell *matHeaderCellDef>
                    <mat-checkbox (change)="$event ? masterToggle() : null"
                        [checked]="selection.hasValue() && isAllSelected()"
                        [indeterminate]="selection.hasValue() && !isAllSelected()" [aria-label]="checkboxLabel()">
                    </mat-checkbox>
                </th>
                <td mat-cell *matCellDef="let row">
                    <span style="display: flex; justify-content: space-between; width: 60px; line-height: 24px;">

                        <mat-checkbox (click)="$event.stopPropagation()"
                            (change)="rowSelected($event.checked, row)" [checked]="selection.isSelected(row)"
                            [aria-label]="checkboxLabel(row)">
                        </mat-checkbox>

                        <mat-icon (click)="onRootExpandClick(row)" *ngIf="row.hasChildren && row.isRoot"
                            class="mat-icon-rtl-mirror tree-icon">
                            {{row.isExpand ? 'expand_more' : 'chevron_right'}}
                        </mat-icon>
                    </span>
                </td>
            </ng-container>

            <!-- Position Column -->
            <!-- <ng-container matColumnDef="position">
                <th mat-header-cell *matHeaderCellDef> № </th>
                <td mat-cell *matCellDef="let element"><span> {{element.isRoot? "" : element.position}} </span></td>
            </ng-container> -->

            <!-- Name Column -->
            <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef> Наименование базы </th>
                <td mat-cell *matCellDef="let element">
                    <span>
                        <div [ngClass]="{'hide-name-value': editingRow?.guid === element.guid}" class="name-value">
                            <div (click)="$event.stopPropagation();startNameEdit(element, editInput)">{{element.name}}
                            </div>
                        </div>
                        <div [ngClass]="{'show-name-input': editingRow?.guid === element.guid}" class="hide-name-input"
                            (click)="$event.stopPropagation();">
                            <input #editInput class="name-input" matInput autofocus autocomplete="off" type="text"
                                (blur)="finishEditing('', true)" (keyup)="onNameEditing($event, editInput.value)">
                        </div>
                    </span>
                </td>
            </ng-container>

            <!-- availability Column -->
            <ng-container matColumnDef="availability">
                <th mat-header-cell *matHeaderCellDef>
                    Доступность
                    <mat-checkbox style="margin-left: 10px;"
                            (click)="$event.stopPropagation()"
                        [checked]="allAvailableState === 'checked'"
                        [disabled]="allAvailableState === 'checked'"
                        [indeterminate]="allAvailableState === 'mixed'"
                        (change)="toggleGlobalChange(true)">
                        Все доступны
                   </mat-checkbox>
                   <mat-checkbox style="margin-left: 5px;"
                            (click)="$event.stopPropagation()"
                            [checked]="allAvailableState === 'unchecked'"
                        [disabled]="allAvailableState === 'unchecked'"
                        [indeterminate]="allAvailableState === 'mixed'"
                        (change)="toggleGlobalChange(false)">
                       Все не доступны
                  </mat-checkbox>
                </th>
                <td mat-cell *matCellDef="let element">
                    <span>
                        <div>
                            <mat-slide-toggle (click)="$event.stopPropagation()"
                                (change)="toggleChange($event.checked, element)"
                                *ngIf="element.availability !== 'awaiting'" [checked]="element.availability"
                                labelPosition="after">{{element.availability ? "Доступна" : "Не доступна"}}
                            </mat-slide-toggle>
                            <mat-progress-spinner color="accent" diameter="30"
                                *ngIf="element.availability === 'awaiting'" mode="indeterminate">
                            </mat-progress-spinner>
                        </div>
                    </span>
                </td>
            </ng-container>
            <!-- baseType Column -->
            <ng-container matColumnDef="baseType">
                <th mat-header-cell *matHeaderCellDef> Тип базы </th>
                <td mat-cell *matCellDef="let element">
                    <span>
                        {{element.baseTypeName}}
                    </span>
                 </td>
            </ng-container>

            <!-- cancelled Column -->
            <ng-container matColumnDef="cancelled">
                <th mat-header-cell *matHeaderCellDef> Отменена </th>
                <td mat-cell *matCellDef="let element">
                    <span>
                        <mat-checkbox style="margin-left: 10px;"
                            [checked]="element.isCancelled"
                            (click)="$event.stopPropagation()"
                            (change)="toggleCancelChange($event.checked, element)">
                        Отменена
                   </mat-checkbox>
                    </span>
                 </td>
            </ng-container>

            <!-- availableChilds Column -->
            <ng-container matColumnDef="availableChilds">
                <th mat-header-cell *matHeaderCellDef> Доступные дочерние типы </th>
                <td mat-cell *matCellDef="let element">
                     <span *ngIf="!!element.isRoot">
                         <div class="button-group">
                                <mat-checkbox
                                 [checked]="isIncludeChildNodes(availabilityNodes.Normatives, element)"
                                 (change)="toggleAvailableChildChange($event, element)">
                                    Нормативы
                                </mat-checkbox>
                                <mat-checkbox
                                 [checked]="isIncludeChildNodes(availabilityNodes.Indexes, element)"
                                 (change)="toggleAvailableChildChange($event, element)">
                                    Индексы
                                </mat-checkbox>
                                <mat-checkbox
                                 [checked]="isIncludeChildNodes(availabilityNodes.Corrections, element)"
                                 (change)="toggleAvailableChildChange($event, element)">
                                    Поправки
                                </mat-checkbox>
                        </div>
                     </span>
                     <span *ngIf="!element.isRoot">
                        --
                    </span>
                 </td>
            </ng-container>

           

            <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true" class="header-row"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;" [ngClass]="{'hide-row': row.isHide}"
            [ngClass]="{'root-row': row.isRoot}"
                class="row-common" (click)="onRowClick(row)">
            </tr>
        </table>
    </div>
    <!-- <div class="load-spinner-container" *ngIf="!data.length">
        <mat-progress-spinner diameter="300" mode="indeterminate" color="accent"></mat-progress-spinner>
    </div> -->
</div>